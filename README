Some performance tests of Neo4j and Neo4j.rb

The test creates a Neo4j Database by importing file information
from the filesystem. Then it calculates the total size of all
those files by traversing the tree in Neo4j.

There are three tests
* Running the traversal just using the Java API
* Running the traversal just using the Java API from JRuby
* Running the traversal using the Neo4j.rb wrapper

=== To Execute

Type:

  > bundle 
  > rake create
  > rake java  
  > rake jruby
  > rake wrapper

rake create asks for an location on the filesystem. You should
have at least 300.000 folder and files in that location in order to
get some realistic test result.

=== My Results

Calling directly the Java API from JRuby is around 6 times slower then just executing everything from Java.
Running my JRuby wrapper is 50 % slower then directly calling the Java API from JRuby.
Maybe because I'm extending some java classes from JRuby ???

It also looks like the bigger graph to traverse the slower JRuby is compared to directly using Java.
On just traversing 40.000 nodes JRuby is only 3-4 times slower. 

I'm using JRuby 1.5.5 on Ubuntu 32 bit OS, Java version 1.6.0_22


=== Running from Java

> rake java

java -Xms2048m -Xmx2048m -Xmn512m -server -cp jars/neo4j-kernel-1.2-1.2.M03.jar:jars/geronimo-jta_1.1_spec-1.1.1.jar:target neo4j.NeoTraversal
1 -- traversed 388511 nodes, 5772133747 bytes, in 7.388 seconds
2 -- traversed 388511 nodes, 5772133747 bytes, in 0.447 seconds
3 -- traversed 388511 nodes, 5772133747 bytes, in 0.413 seconds
4 -- traversed 388511 nodes, 5772133747 bytes, in 0.41 seconds
5 -- traversed 388511 nodes, 5772133747 bytes, in 0.413 seconds
6 -- traversed 388511 nodes, 5772133747 bytes, in 0.412 seconds
7 -- traversed 388511 nodes, 5772133747 bytes, in 0.71 seconds
8 -- traversed 388511 nodes, 5772133747 bytes, in 0.405 seconds
9 -- traversed 388511 nodes, 5772133747 bytes, in 0.41 seconds
10 -- traversed 388511 nodes, 5772133747 bytes, in 0.407 seconds
11 -- traversed 388511 nodes, 5772133747 bytes, in 0.406 seconds
12 -- traversed 388511 nodes, 5772133747 bytes, in 0.405 seconds
13 -- traversed 388511 nodes, 5772133747 bytes, in 0.662 seconds
14 -- traversed 388511 nodes, 5772133747 bytes, in 0.404 seconds
15 -- traversed 388511 nodes, 5772133747 bytes, in 0.405 seconds
16 -- traversed 388511 nodes, 5772133747 bytes, in 0.412 seconds
17 -- traversed 388511 nodes, 5772133747 bytes, in 0.407 seconds
18 -- traversed 388511 nodes, 5772133747 bytes, in 0.405 seconds
19 -- traversed 388511 nodes, 5772133747 bytes, in 0.663 seconds
20 -- traversed 388511 nodes, 5772133747 bytes, in 0.402 seconds
21 -- traversed 388511 nodes, 5772133747 bytes, in 0.407 seconds
22 -- traversed 388511 nodes, 5772133747 bytes, in 0.405 seconds
23 -- traversed 388511 nodes, 5772133747 bytes, in 0.669 seconds
24 -- traversed 388511 nodes, 5772133747 bytes, in 0.41 seconds
25 -- traversed 388511 nodes, 5772133747 bytes, in 0.408 seconds

=== Running directly from JRuby

> rake jruby

/usr/bin/env jruby -J-Xms2048m -J-Xmx2048m -J-Xmn512m --server jruby.rb
1 -- traversed 388511 nodes 5772133747 bytes, in 10.003 seconds
2 -- traversed 388511 nodes 5772133747 bytes, in 2.7 seconds
3 -- traversed 388511 nodes 5772133747 bytes, in 4.343 seconds
4 -- traversed 388511 nodes 5772133747 bytes, in 2.721 seconds
5 -- traversed 388511 nodes 5772133747 bytes, in 3.095 seconds
6 -- traversed 388511 nodes 5772133747 bytes, in 3.11 seconds
7 -- traversed 388511 nodes 5772133747 bytes, in 2.653 seconds
8 -- traversed 388511 nodes 5772133747 bytes, in 3.085 seconds
9 -- traversed 388511 nodes 5772133747 bytes, in 3.168 seconds
10 -- traversed 388511 nodes 5772133747 bytes, in 2.878 seconds
11 -- traversed 388511 nodes 5772133747 bytes, in 2.825 seconds
12 -- traversed 388511 nodes 5772133747 bytes, in 2.676 seconds
13 -- traversed 388511 nodes 5772133747 bytes, in 3.246 seconds
14 -- traversed 388511 nodes 5772133747 bytes, in 2.531 seconds
15 -- traversed 388511 nodes 5772133747 bytes, in 3.348 seconds
16 -- traversed 388511 nodes 5772133747 bytes, in 2.577 seconds
17 -- traversed 388511 nodes 5772133747 bytes, in 3.081 seconds
18 -- traversed 388511 nodes 5772133747 bytes, in 2.92 seconds
19 -- traversed 388511 nodes 5772133747 bytes, in 2.611 seconds
20 -- traversed 388511 nodes 5772133747 bytes, in 3.433 seconds
21 -- traversed 388511 nodes 5772133747 bytes, in 2.607 seconds
22 -- traversed 388511 nodes 5772133747 bytes, in 2.602 seconds
23 -- traversed 388511 nodes 5772133747 bytes, in 3.463 seconds
24 -- traversed 388511 nodes 5772133747 bytes, in 2.632 seconds
25 -- traversed 388511 nodes 5772133747 bytes, in 2.633 seconds

=== Running from Neo4j.rb wrapper

andreas@andreas-laptop:~/tmp/neo4j-perf$ rake wrapper
/usr/bin/env jruby -J-Xms2048m -J-Xmx2048m -J-Xmn512m --server wrapper.rb
1 -- traversed 388510 nodes 5772133747 bytes, in 10.354 seconds
2 -- traversed 388510 nodes 5772133747 bytes, in 4.439 seconds
3 -- traversed 388510 nodes 5772133747 bytes, in 3.66 seconds
4 -- traversed 388510 nodes 5772133747 bytes, in 3.601 seconds
5 -- traversed 388510 nodes 5772133747 bytes, in 3.555 seconds
6 -- traversed 388510 nodes 5772133747 bytes, in 3.432 seconds
7 -- traversed 388510 nodes 5772133747 bytes, in 3.563 seconds
8 -- traversed 388510 nodes 5772133747 bytes, in 3.324 seconds
9 -- traversed 388510 nodes 5772133747 bytes, in 3.331 seconds
10 -- traversed 388510 nodes 5772133747 bytes, in 3.385 seconds
11 -- traversed 388510 nodes 5772133747 bytes, in 3.675 seconds
12 -- traversed 388510 nodes 5772133747 bytes, in 3.394 seconds
13 -- traversed 388510 nodes 5772133747 bytes, in 3.4 seconds
14 -- traversed 388510 nodes 5772133747 bytes, in 3.437 seconds
15 -- traversed 388510 nodes 5772133747 bytes, in 3.401 seconds
16 -- traversed 388510 nodes 5772133747 bytes, in 3.484 seconds
17 -- traversed 388510 nodes 5772133747 bytes, in 3.403 seconds
18 -- traversed 388510 nodes 5772133747 bytes, in 3.434 seconds
19 -- traversed 388510 nodes 5772133747 bytes, in 3.428 seconds
20 -- traversed 388510 nodes 5772133747 bytes, in 3.423 seconds
21 -- traversed 388510 nodes 5772133747 bytes, in 3.161 seconds
22 -- traversed 388510 nodes 5772133747 bytes, in 3.416 seconds
23 -- traversed 388510 nodes 5772133747 bytes, in 3.415 seconds
24 -- traversed 388510 nodes 5772133747 bytes, in 3.415 seconds
25 -- traversed 388510 nodes 5772133747 bytes, in 3.409 seconds


java -Xms2048m -Xmx2048m -Xmn512m -server -cp jars/neo4j-kernel-1.2-1.2.M03.jar:jars/geronimo-jta_1.1_spec-1.1.1.jar:target neo4j.NeoTraversal
1 -- traversed 45329 nodes, 501430271 bytes, in 1.792 seconds
2 -- traversed 45329 nodes, 501430271 bytes, in 0.105 seconds
3 -- traversed 45329 nodes, 501430271 bytes, in 0.063 seconds
4 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
5 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
6 -- traversed 45329 nodes, 501430271 bytes, in 0.057 seconds
7 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
8 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
9 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
10 -- traversed 45329 nodes, 501430271 bytes, in 0.059 seconds
11 -- traversed 45329 nodes, 501430271 bytes, in 0.059 seconds
12 -- traversed 45329 nodes, 501430271 bytes, in 0.064 seconds
13 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
14 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
15 -- traversed 45329 nodes, 501430271 bytes, in 0.057 seconds
16 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
17 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
18 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
19 -- traversed 45329 nodes, 501430271 bytes, in 0.057 seconds
20 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
21 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
22 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
23 -- traversed 45329 nodes, 501430271 bytes, in 0.057 seconds
24 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds
25 -- traversed 45329 nodes, 501430271 bytes, in 0.058 seconds

/usr/bin/env jruby -J-Xms2048m -J-Xmx2048m -J-Xmn512m --server jruby.rb
JRuby limited openssl loaded. http://jruby.org/openssl
gem install jruby-openssl for full support.
1 -- traversed 45329 nodes 501430271 bytes, in 2.65 seconds
2 -- traversed 45329 nodes 501430271 bytes, in 0.389 seconds
3 -- traversed 45329 nodes 501430271 bytes, in 0.782 seconds
4 -- traversed 45329 nodes 501430271 bytes, in 0.193 seconds
5 -- traversed 45329 nodes 501430271 bytes, in 0.197 seconds
6 -- traversed 45329 nodes 501430271 bytes, in 0.255 seconds
7 -- traversed 45329 nodes 501430271 bytes, in 0.2 seconds
8 -- traversed 45329 nodes 501430271 bytes, in 0.202 seconds
9 -- traversed 45329 nodes 501430271 bytes, in 0.201 seconds
10 -- traversed 45329 nodes 501430271 bytes, in 1.089 seconds
11 -- traversed 45329 nodes 501430271 bytes, in 0.191 seconds
12 -- traversed 45329 nodes 501430271 bytes, in 0.191 seconds
13 -- traversed 45329 nodes 501430271 bytes, in 0.192 seconds
14 -- traversed 45329 nodes 501430271 bytes, in 0.193 seconds
15 -- traversed 45329 nodes 501430271 bytes, in 0.195 seconds
16 -- traversed 45329 nodes 501430271 bytes, in 0.293 seconds
17 -- traversed 45329 nodes 501430271 bytes, in 1.104 seconds
18 -- traversed 45329 nodes 501430271 bytes, in 0.195 seconds
19 -- traversed 45329 nodes 501430271 bytes, in 0.199 seconds
20 -- traversed 45329 nodes 501430271 bytes, in 0.197 seconds
21 -- traversed 45329 nodes 501430271 bytes, in 0.199 seconds
22 -- traversed 45329 nodes 501430271 bytes, in 0.215 seconds
23 -- traversed 45329 nodes 501430271 bytes, in 0.226 seconds
24 -- traversed 45329 nodes 501430271 bytes, in 1.122 seconds
25 -- traversed 45329 nodes 501430271 bytes, in 0.195 seconds


/usr/bin/env jruby -J-Xms2048m -J-Xmx2048m -J-Xmn512m --server wrapper.rb
1 -- traversed 45328 nodes 501430271 bytes, in 3.009 seconds
2 -- traversed 45328 nodes 501430271 bytes, in 0.621 seconds
3 -- traversed 45328 nodes 501430271 bytes, in 0.318 seconds
4 -- traversed 45328 nodes 501430271 bytes, in 0.334 seconds
5 -- traversed 45328 nodes 501430271 bytes, in 0.31 seconds
6 -- traversed 45328 nodes 501430271 bytes, in 0.682 seconds
7 -- traversed 45328 nodes 501430271 bytes, in 0.292 seconds
8 -- traversed 45328 nodes 501430271 bytes, in 0.303 seconds
9 -- traversed 45328 nodes 501430271 bytes, in 0.305 seconds
10 -- traversed 45328 nodes 501430271 bytes, in 0.301 seconds
11 -- traversed 45328 nodes 501430271 bytes, in 0.646 seconds
12 -- traversed 45328 nodes 501430271 bytes, in 0.294 seconds
13 -- traversed 45328 nodes 501430271 bytes, in 0.291 seconds
14 -- traversed 45328 nodes 501430271 bytes, in 0.293 seconds
15 -- traversed 45328 nodes 501430271 bytes, in 0.302 seconds
16 -- traversed 45328 nodes 501430271 bytes, in 0.659 seconds
17 -- traversed 45328 nodes 501430271 bytes, in 0.296 seconds
18 -- traversed 45328 nodes 501430271 bytes, in 0.291 seconds
19 -- traversed 45328 nodes 501430271 bytes, in 0.294 seconds
20 -- traversed 45328 nodes 501430271 bytes, in 0.295 seconds
21 -- traversed 45328 nodes 501430271 bytes, in 0.632 seconds
22 -- traversed 45328 nodes 501430271 bytes, in 0.292 seconds
23 -- traversed 45328 nodes 501430271 bytes, in 0.293 seconds
24 -- traversed 45328 nodes 501430271 bytes, in 0.293 seconds
25 -- traversed 45328 nodes 501430271 bytes, in 0.656 seconds
